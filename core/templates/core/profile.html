{% extends "core/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="min-h-screen bg-gradient-to-b from-sky-200 via-blue-50 to-white py-12 px-4 sm:px-6 lg:px-8 relative overflow-hidden">

    <div class="absolute top-10 left-10 w-48 h-48 bg-white/40 rounded-full blur-3xl pointer-events-none"></div>
    <div class="absolute bottom-20 right-10 w-64 h-64 bg-sky-300/20 rounded-full blur-3xl pointer-events-none"></div>

    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 relative z-10">
        
        <div class="md:col-span-1">
            <div class="bg-white/80 backdrop-blur-md p-8 rounded-3xl shadow-xl border border-sky-100 text-center sticky top-24 transition-all hover:shadow-sky-200/50">
                <div class="relative inline-block mb-4">
                    <img class="w-32 h-32 rounded-full mx-auto object-cover border-4 border-white shadow-md ring-2 ring-sky-100" src="{{ profile_user.profile_picture.url }}" alt="Profile picture of {{ profile_user.username }}">
                    <span class="absolute bottom-2 right-2 w-5 h-5 bg-green-400 border-4 border-white rounded-full"></span>
                </div>
                
                <h2 class="text-2xl font-extrabold text-sky-900">{{ profile_user.username }}</h2>
                <p class="text-sky-600/80 font-medium text-sm mt-1">{{ profile_user.email }}</p>
                
                {% if profile_user.phone_number %}
                    <div class="mt-3 inline-flex items-center px-3 py-1 rounded-full bg-sky-50 text-sky-700 text-xs font-semibold border border-sky-100">
                        üìû {{ profile_user.phone_number }}
                    </div>
                {% endif %}

                <div class="mt-6 text-gray-600 text-sm leading-relaxed bg-white/50 p-4 rounded-2xl border border-sky-50">
                    {{ profile_user.bio|default:"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡∏ß" }}
                </div>

                {% if profile_user == user %}
                <div class="mt-6">
                    <a href="{% url 'profile-edit' %}" class="w-full inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-full shadow-md text-sm font-bold text-white bg-gradient-to-r from-sky-400 to-blue-500 hover:from-sky-500 hover:to-blue-600 transform hover:-translate-y-0.5 transition-all">
                        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="md:col-span-2 space-y-8">
            
            <div class="bg-white/80 backdrop-blur-md p-8 rounded-3xl shadow-xl border border-sky-100">
                <h3 class="text-xl font-bold text-sky-900 mb-6 flex items-center">
                    <span class="bg-sky-100 p-2 rounded-lg mr-3 shadow-sm">üéâ</span> ‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
                </h3>
                
                <ul class="space-y-3">
                    {% for post in profile_user.joined_posts.all %}
                        <li>
                            <a href="{% url 'post-detail' post.pk %}" class="flex items-center justify-between p-4 rounded-xl bg-white border border-sky-50 hover:border-sky-300 hover:shadow-md hover:bg-sky-50/30 transition-all group">
                                <div class="flex items-center space-x-3">
                                    <span class="w-2 h-2 rounded-full bg-sky-400 group-hover:scale-125 transition-transform"></span>
                                    <span class="font-medium text-gray-700 group-hover:text-sky-700 transition-colors">{{ post.title }}</span>
                                </div>
                                <span class="text-xs text-sky-500 font-semibold bg-sky-50 px-3 py-1 rounded-full group-hover:bg-sky-100 transition-colors">‡πÑ‡∏õ‡∏î‡∏π‡πÄ‡∏•‡∏¢ &rarr;</span>
                            </a>
                        </li>
                    {% empty %}
                        <li class="text-center py-10 text-gray-400 bg-sky-50/50 rounded-xl border-2 border-dashed border-sky-100">
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡πÉ‡∏î‡πÜ</p>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="bg-white/80 backdrop-blur-md p-8 rounded-3xl shadow-xl border border-sky-100">
                <h3 class="text-xl font-bold text-sky-900 mb-6 flex items-center">
                    <span class="bg-sky-100 p-2 rounded-lg mr-3 shadow-sm">üí¨</span> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô
                </h3>

                {% if user.is_authenticated %}
                    <form method="post" action="{% url 'add-comment' profile_user.pk %}" class="mb-8">
                        {% csrf_token %}
                        <div class="bg-white p-2 rounded-2xl border border-sky-200 focus-within:ring-4 focus-within:ring-sky-100 focus-within:border-sky-300 transition-all">
                            {{ comment_form|crispy }}
                        </div>
                        <div class="mt-3 flex justify-end">
                            <button type="submit" class="px-6 py-2 rounded-full text-sm font-bold text-white bg-sky-500 hover:bg-sky-600 shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5">
                                ‡∏™‡πà‡∏á
                            </button>
                        </div>
                    </form>
                {% else %}
                    <div class="text-center py-6 bg-sky-50 rounded-2xl mb-8 border border-sky-100">
                        <p class="text-sky-800">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ <a href="{% url 'account_login' %}" class="font-bold underline decoration-sky-300 decoration-2 hover:text-sky-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</p>
                    </div>
                {% endif %}
                
                <div class="space-y-6">
                    {% for comment in comments %}
                    <div class="flex items-start space-x-4">
                        <img class="h-12 w-12 rounded-full border-2 border-white shadow-sm object-cover" src="{{ comment.author.profile_picture.url }}" alt="">
                        <div class="flex-1 bg-white p-5 rounded-2xl rounded-tl-none shadow-sm border border-sky-50 relative hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-baseline mb-2">
                                <h4 class="text-sm font-bold text-sky-900">{{ comment.author.username }}</h4>
                                <span class="text-[10px] text-gray-400 uppercase tracking-wide">{{ comment.created_at|timesince }} ago</span>
                            </div>
                            <p class="text-gray-700 text-sm leading-relaxed">{{ comment.comment }}</p>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-8">
                        <div class="inline-block p-3 rounded-full bg-sky-50 mb-3">
                            <svg class="w-6 h-6 text-sky-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                        </div>
                        <p class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏¢!</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}